/*
Media-API Client (1.1.1)
*/
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.MediaApiClient=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(b,c,d){(function(e){!function(b){if("object"==typeof d&&"undefined"!=typeof c)c.exports=b();else if("function"==typeof a&&a.amd)a([],b);else{var f;f="undefined"!=typeof window?window:"undefined"!=typeof e?e:"undefined"!=typeof self?self:this,f.domel=b()}}(function(){return function a(c,d,e){function f(h,i){if(!d[h]){if(!c[h]){var j="function"==typeof b&&b;if(!i&&j)return j(h,!0);if(g)return g(h,!0);var k=new Error("Cannot find module '"+h+"'");throw k.code="MODULE_NOT_FOUND",k}var l=d[h]={exports:{}};c[h][0].call(l.exports,function(a){var b=c[h][1][a];return f(b?b:a)},l,l.exports,a,c,d,e)}return d[h].exports}for(var g="function"==typeof b&&b,h=0;h<e.length;h++)f(e[h]);return f}({1:[function(a,b,c){var d,e,f,g,h,i=[].slice,j=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};g=function(a){return"string"==typeof a||a instanceof String},h=["domel","create","byClass","byId"],e=function(a,b,c){return null==c&&(c=0),function(){var d;return d=1<=arguments.length?i.call(arguments,0):[],d.splice(c,0,b),a.apply(f,d)}},d=function(a,b){var c,d,g,i;if(null==b&&(b="d"),null==a)return a;if(null!=a[b])return a;for(a[b]={},i=Object.keys(f),c=0,d=i.length;d>c;c++)g=i[c],j.call(h,g)<0&&(a[b][g]=e(f[g],a));return a[b].find=e(f,a,1),a[b].byId=e(f.byId,a,1),a[b].byClass=e(f.byClass,a,1),a},f=function(a,b,c){var e,g,h,i,j;if(null==b&&(b=document),null==c&&(c=!1),i=a.split(" "),i.every(function(a){var b;return"."===(b=a[0])||"#"===b})){for(;i.length;)if(h=null!=(j=i.splice(0,1))?j[0]:void 0)switch(h[0]){case".":b=f.byClass(h,b,c);break;case"#":b=f.byId(h,b,c)}return b}return g=b.querySelectorAll(a),c?d(null!=g?g[0]:void 0):function(){var a,b,c;for(c=[],a=0,b=g.length;b>a;a++)e=g[a],c.push(d(e));return c}()},f.domel=function(a){return null!=a?d(a):void 0},f.create=function(a,b){var c,e,f;null==a&&(a="DIV"),null==b&&(b={}),c=document.createElement(a);for(e in b)f=b[e],c.setAttribute(e,f);return d(c)},f.data=function(a,b,c){if(null==(null!=a?a.dataset:void 0)){if(null!=c)return;return d(a)}if(null!=b&&null!=c)a.dataset[b]=c;else if(null!=b)return a.dataset[b];return a.dataset},f.attr=function(a,b,c){return null!=b&&null!=c?a.setAttribute(b,c):null!=b&&a.getAttribute(b),a},f.byClass=function(a,b,c){var e,f;return null==b&&(b=document),null==c&&(c=!1),"."===a[0]&&(a=a.slice(1)),f=b.getElementsByClassName(a),c?d(null!=f?f[0]:void 0):function(){var a,b,c;for(c=[],a=0,b=f.length;b>a;a++)e=f[a],c.push(d(e));return c}()},f.byId=function(a,b){return null==b&&(b=document),"#"===a[0]&&(a=a.slice(1)),d(b.getElementById(a))},f.last=function(a,b){var c;for(c=a.childNodes.length-1;c>=0;){if(f.is(a.childNodes[c],b))return d(a.childNodes[c]);c--}return null},f.parent=function(a,b){var c;if(null==b)return d(a.parentNode);for(c=a;null!=c.parentNode;)if(c=c.parentNode,f.is(c,b))return d(c);return null},f.first=function(a,b){var c,e,g,h,i;for(e=a.childNodes.length-1,i=a.childNodes,g=0,h=i.length;h>g;g++)if(c=i[g],f.is(c,b))return d(c);return null},f.children=function(a,b){var c,e,g,h,i,j;for(e=[],g=a.childNodes.length-1,j=a.childNodes,h=0,i=j.length;i>h;h++)c=j[h],f.is(c,b)&&e.push(d(c));return e},f.countChildren=function(a,b){return f.children(a,b).length},f.is=function(a,b){return"."===b[0]?f.hasClass(a,b.slice(1)):"#"===b[0]?f.hasId(a,b.slice(1)):!1},f.hasClass=function(a,b){var c;return null!=a.classList?a.classList.contains(b):null==(null!=a?a.className:void 0)?!1:j.call((null!=a&&null!=(c=a.className)?c.split(" "):void 0)||[],b)>=0?!0:!1},f.hide=function(a){return null==(null!=a?a.style:void 0)?null:(a.style.display="none",a)},f.show=function(a,b){return null==b&&(b="block"),null==(null!=a?a.style:void 0)?null:(a.style.display=b,a)},f.addClass=function(a,b){var c;if(!this.hasClass(a,b))return c=a.className,c.length?(a.className+=" "+b,d(a)):void(a.className=b)},f.removeClass=function(a,b){var c,e;if(this.hasClass(a,b))return c=a.className,e=new RegExp("\\s?\\b"+b+"\\b","g"),c=c.replace(e,""),a.className=c,d(a)},f.hasId=function(a,b){return(null!=a?a.id:void 0)===b?!0:!1},f.append=function(a,b){var c,e,f,h,i,j,k;if(g(b))for(c=document.createElement("div"),c.innerHTML=b,k=c.childNodes,f=0,i=k.length;i>f;f++)e=k[f],null!=(null!=e?e.tagName:void 0)&&a.appendChild(e);else if(b instanceof HTMLCollection)for(h=0,j=b.length;j>h;h++)e=b[h],a.appendChild(e);else b instanceof Element&&a.appendChild(b);return d(a)},f.prepend=function(a,b){var c,e,g,h,i,j,k;if(c=null!=(j=a.childNodes)?j[0]:void 0,null==c)return void f.append(a,b);for(e=document.createElement("div"),e.innerHTML=b,g=c,k=e.childNodes,i=k.length-1;i>=0;i+=-1)h=k[i],null!=(null!=h?h.tagName:void 0)&&(a.insertBefore(h,g),g=h);return d(a)},f.remove=function(a){var b;if(a instanceof Element&&a.parentElement.removeChild(a),a instanceof HTMLCollection)for(b=a.length-1;b>=0;)a[b]&&a[b].parentElement&&a[b].parentElement.removeChild(a[b]),b--;return d(a)},f.empty=function(a){return a.innerHTML="",d(a)},f.replaceWith=function(a,b){return f.parent(a).replaceChild(b,a),a},f.clone=function(a){return d(a.cloneNode(!0))},f.on=function(a,b,c){return null!=a?(null!=a.addEventListener?a.addEventListener(b,c,!1):null!=a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c,a):void 0},f.off=function(a,b,c){return null!=a?(null!=a.removeEventListener?a.removeEventListener(b,c,!1):null!=a.detachEvent?a.detachEvent("on"+b,c):delete a["on"+b],a):void 0},f.emit=function(a,b){var c;return c=document.createEvent("Event"),c.initEvent(b,!0,!1),a.dispatchEvent(c),c},b.exports=f},{}]},{},[1])(1)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(a,b,c){var d,e=function(a,b){return function(){return a.apply(b,arguments)}},f=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},g={}.hasOwnProperty;d=function(a){function b(){return this._error=e(this._error,this),b.__super__.constructor.apply(this,arguments)}return f(b,a),b.prototype._error=function(a,b){var c;if(b instanceof Error)c=b;else{c=new Error(b),c.name=b;try{c.message=this.ERRORS[b]||" - "}catch(d){}}if(null==a)throw c;a(c)},b}(a("events")),b.exports=d},{events:8}],3:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o=function(a,b){return function(){return a.apply(b,arguments)}},p=function(a,b){function c(){this.constructor=a}for(var d in b)q.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},q={}.hasOwnProperty,r=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};l=a("domel"),n=a("xhr"),m=a("./utils"),d=a("./base"),f=a("./file"),g=a("./fileview"),i={host:null,domain:null,accesskey:null,keyprefix:"clientupload",autostart:!0,requestSignFn:null,resultTemplateFn:null,maxsize:0,maxcount:0,width:null,height:null,accept:null,ttl:0,acl:"public-read",properties:null,tags:null,"content-disposition":null,cssdroppable:"dropable",csshover:"hover",cssprocess:"process",cssdisabled:"disabled"},h=function(){var a;a=[];for(j in i)k=i[j],a.push(j);return a}(),e=function(a){function b(a,c,d){var e,f,g,h,j,k,l,n,p,q,r,s,t,u,v;if(null==d&&(d={}),this._validateEl=o(this._validateEl,this),this._checkFinish=o(this._checkFinish,this),this.onFinish=o(this.onFinish,this),this.fileNew=o(this.fileNew,this),this.fileError=o(this.fileError,this),this.fileDone=o(this.fileDone,this),this.enable=o(this.enable,this),this.disable=o(this.disable,this),this.abortAll=o(this.abortAll,this),this._defaultRequestSignature=o(this._defaultRequestSignature,this),this.sign=o(this.sign,this),this.deleteFile=o(this.deleteFile,this),this.upload=o(this.upload,this),this.onLeave=o(this.onLeave,this),this.onOver=o(this.onOver,this),this.onHover=o(this.onHover,this),this.onSelect=o(this.onSelect,this),this.initFileAPI=o(this.initFileAPI,this),this.initialize=o(this.initialize,this),b.__super__.constructor.apply(this,arguments),this.enabled=!0,this.useFileAPI=!1,this.on("file.new",this.fileNew),this.on("file.done",this.fileDone),this.on("file.error",this.fileError),this.on("file.invalid",this.fileError),this.on("file.aborted",this.fileError),this.on("finish",this.onFinish),this.within_enter=!1,this.el=this._validateEl(a,"drag"),this.sel=this.el.d.find("input"+(d.inputclass||"")+"[type='file']",!0),null==this.sel)return void this._error(null,"missing-select-el");if(this.formname=this.sel.getAttribute("name"),null!=c&&(this.res=this._validateEl(c,"result")),f=this.el.d.data(),this.options=m.assign({},i,f,d||{}),!(null!=(q=this.options.host)?q.length:void 0))return void this._error(null,"missing-host");if(!this._rgxHost.test(this.options.host))return void this._error(null,"invalid-host");if(!(null!=(r=this.options.domain)?r.length:void 0))return void this._error(null,"missing-domain");if(!(null!=(s=this.options.accesskey)?s.length:void 0))return void this._error(null,"missing-accesskey");if(null!=this.options.maxcount&&(h=parseInt(this.options.maxcount,10),isNaN(h)?this.options.maxcount=i.maxcount:this.options.maxcount=h),1!==this.options.maxcount&&this.sel.setAttribute("multiple","multiple"),null!=this.options.maxsize&&(j=parseInt(this.options.maxsize,10),isNaN(j)?this.options.maxsize=i.maxsize:this.options.maxsize=j),null!=this.options.requestSignFn&&"function"!=typeof this.options.requestSignFn)return void this._error(null,"invalid-requestSignfn");if(null!=this.options.ttl&&!m.isInt(this.options.ttl))return void this._error(null,"invalid-ttl");if(null!=this.options.ttl&&(this.options.ttl=parseInt(this.options.ttl,10),isNaN(this.options.ttl)))return void this._error(null,"invalid-ttl");if(null!=this.options.tags&&m.isArray(this.options.tags)){for(t=this.options.tags,n=0,p=t.length;p>n;n++)if(l=t[n],!m.isString(l))return void this._error(null,"invalid-tags")}else if(null!=this.options.tags)return void this._error(null,"invalid-tags");return null==this.options.properties||m.isObject(this.options.properties)?null==this.options["content-disposition"]||m.isString(this.options["content-disposition"])?null==this.options.acl||m.isString(this.options.acl)||"public-read"===(u=this.options.acl)||"authenticated-read"===u?(null!=this.options.requestSignFn&&_.isFunction(this.options.requestSignFn)?this._sign=this.options.requestSignFn:this._sign=this._defaultRequestSignature,g=this.sel.getAttribute("accept"),(null!=this.options.accept||null!=g)&&(e=(null!=g?g.split(","):void 0)||[],k=(null!=(v=this.options.accept)?v.split(","):void 0)||[],(null!=e?e.length:void 0)?this.options.accept=e:(null!=k?k.length:void 0)&&this.sel.setAttribute("accept",this.options.accept),this.options.acceptRules=this.generateAcceptRules(this.options.accept)),this.initialize(),this.idx_started=0,this.idx_finished=0,void this.el.d.data("mediaapiclient",this)):void this._error(null,"invalid-acl"):void this._error(null,"invalid-content-disposition"):void this._error(null,"invalid-properties")}return p(b,a),b.prototype.version="1.1.1",b.prototype._rgxHost=/https?:\/\/[^\/$\s]+/i,b.prototype.generateAcceptRules=function(a){var b,c,d,e;for(c=[],d=0,e=a.length;e>d;d++)b=a[d],b.indexOf("/")>=0?c.push(function(){var a;return a=new RegExp(b.replace("*","\\w+")+"$","i"),function(b){return a.test(b.type)}}()):b.indexOf(".")>=0?c.push(function(){var a;return a=new RegExp(b.replace(".","\\.")+"$","i"),function(b){return a.test(b.name)}}()):"*"===b&&c.push(function(a){return!0});return c},b.prototype.initialize=function(){window.File&&window.FileList&&window.FileReader&&(this.sel.d.on("change",this.onSelect),this.useFileAPI=!0,this.initFileAPI())},b.prototype.initFileAPI=function(){var a;a=new XMLHttpRequest,(null!=a?a.upload:void 0)&&(this.el.ondragover=this.onHover,this.el.ondragleave=this.onLeave,this.el.ondrop=this.onSelect,this.el.d.addClass(this.options.cssdroppable))},b.prototype.onSelect=function(a){var b,c,d,e,f,g,h;a.preventDefault(),this.enabled&&(this.options.maxcount<=0||this.idx_started<this.options.maxcount?(this.el.d.removeClass(this.options.csshover),this.el.d.addClass(this.options.cssprocess),b=(null!=(c=a.target)?c.files:void 0)||(null!=(d=a.originalEvent)&&null!=(e=d.target)?e.files:void 0)||(null!=(f=a.dataTransfer)?f.files:void 0)||(null!=(g=a.originalEvent)&&null!=(h=g.dataTransfer)?h.files:void 0),this.upload(b)):(this.el.d.removeClass(this.options.csshover),this.disable()))},b.prototype.onHover=function(a){a.preventDefault(),this.enabled&&(this.emit("file.hover"),this.within_enter=!0,setTimeout(function(a){return function(){return a.within_enter=!1}}(this),0),this.el.d.addClass(this.options.csshover))},b.prototype.onOver=function(a){a.preventDefault(),!this.enabled},b.prototype.onLeave=function(a){this.enabled&&(this.within_enter||this.el.d.removeClass(this.options.csshover))},b.prototype.upload=function(a){var b,c,d,e;if(this.useFileAPI)for(d=c=0,e=a.length;e>c;d=++c)b=a[d],this.enabled&&(this.options.maxcount<=0||this.idx_started<this.options.maxcount?(this.idx_started++,new f(b,this.idx_started,this,this.options)):this.disable())},b.prototype.deleteFile=function(a,b,c){var d;d=this.options.host+this.options.domain+("/"+a+"?revision="+b),this.sign({url:d,key:a},function(a){return function(a,b,d){return a?void c(a):void n({url:b,method:"DELETE"},function(a,b,d){return a?void c(a):void c(null,d)})}}(this))},b.prototype.sign=function(a,b){var c,d,e;return c=m.assign({},{domain:this.options.domain,accesskey:this.options.accesskey,json:null,url:null,key:null},a),(null!=(d=c.url)?d.length:void 0)?(null!=(e=c.key)?e.length:void 0)?void this._sign(c.domain,c.accesskey,c.url,c.key,c.json,function(a,d){var e;return a?void b(a):(e=c.url,e+=e.indexOf("?")>=0?"&":"?",e+="signature="+encodeURIComponent(d),void b(null,e,d))}):void this._error(b,"invalid-sign-key"):void this._error(b,"invalid-sign-url")},b.prototype._defaultRequestSignature=function(a,b,c,d,e,f){var g,h,i;g=this.options.host+a+"/sign/"+b,h=new window.XMLHttpRequest,i=new FormData,i.append("url",c),i.append("key",d),null!=e&&i.append("json",JSON.stringify(e)),n({xhr:h,method:"POST",url:g,body:i},function(a,b,c){return a?(console.error("get sign error",a),void f(a)):void f(null,c)})},b.prototype.abortAll=function(){this.emit("abortAll")},b.prototype.disable=function(){this.sel.setAttribute("disabled","disabled"),this.el.d.addClass(this.options.cssdisabled),this.enabled=!1},b.prototype.enable=function(){this.sel.removeAttribute("disabled"),this.el.d.removeClass(this.options.cssdisabled),this.enabled=!0},b.prototype.fileDone=function(a){this.idx_finished++,this._checkFinish()},b.prototype.fileError=function(a,b){console.error("FILE-ERROR",a,b),this.idx_finished++,this._checkFinish()},b.prototype.fileNew=function(a){var b;null!=this.res&&(b=new g(a,this,this.options),this.res.d.append(b.render()))},b.prototype.onFinish=function(){this.el.d.removeClass(this.options.cssprocess)},b.prototype._checkFinish=function(){this.idx_finished>=this.idx_started&&(this.emit("finish"),this.options.maxcount>0&&this.idx_started>=this.options.maxcount&&this.disable())},b.prototype._validateEl=function(a,b){var c;if(null==a)return void this._error(null,"missing-"+b+"-el");switch(typeof a){case"string":c=l(a,null,!0);break;case"object":a instanceof HTMLElement&&(c=l.domel(a))}return null==c?void this._error(null,"invalid-"+b+"-el"):c},b.prototype.ERRORS={"missing-select-el":"Missing select element. Please define a valid element as a Selector, DOM-node","invalid-select-el":"Invalid select element. Please define a valid element as a Selector, DOM-node","missing-drag-el":"Missing drag element. Please define a valid element as a Selector, DOM-node","invalid-drag-el":"Invalid drag element. Please define a valid element as a Selector, DOM-node","missing-host":"Missing host. You have to defien a host as url starting with `http://` or `https://`.","invalid-host":"Invalid host. You have to defien a host as url starting with `http://` or `https://`.","missing-domain":"Missing domain. You have to define a domain.","missing-accesskey":"Missing accesskey. You have to define a accesskey.","missing-keyprefix":"Missing keyprefix. You have to define a keyprefix.","invalid-sign-url":"please define a `url` to sign the request","invalid-sign-key":"please define a `key` to sign the request","invalid-ttl":"for the option `ttl` only a positiv number is allowed","invalid-tags":"for the option `tags` only an array of strings is allowed","invalid-properties":"for the option `properties` only an object is allowed","invalid-content-disposition":"for the option `content-disposition` only an string like: `attachment; filename=friendly_filename.pdf` is allowed","invalid-acl":"the option acl only accepts the string `public-read` or `authenticated-read`"},b}(d),e.defaults=function(a){for(j in a)k=a[j],r.call(h,j)>=0&&(i[j]=k);return i},b.exports=e},{"./base":2,"./file":4,"./fileview":5,"./utils":7,domel:1,xhr:9}],4:[function(a,b,c){var d,e,f=function(a,b){return function(){return a.apply(b,arguments)}},g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty;e=a("xhr"),d=function(a){function b(a,c,d,e){var g;this.file=a,this.idx=c,this.client=d,this.options=e,this._handleProgress=f(this._handleProgress,this),this._upload=f(this._upload,this),this._sign=f(this._sign,this),this._testMime=f(this._testMime,this),this._validate=f(this._validate,this),this._setState=f(this._setState,this),this.getData=f(this.getData,this),this.getType=f(this.getType,this),this.getName=f(this.getName,this),this.getProgress=f(this.getProgress,this),this.getResult=f(this.getResult,this),this.getState=f(this.getState,this),this.abort=f(this.abort,this),this.start=f(this.start,this),b.__super__.constructor.apply(this,arguments),this.state=0,this.validation=[],this.key=this.options.keyprefix+"_"+this.getName().replace(this._rgxFile2Key,"")+"_"+this._now()+"_"+this.idx,this.client.emit("file.new",this),this.client.on("abortAll",this.abort),this.on("start",this.start),this.on("signed",this._upload),(null!=(g=this.options.keyprefix)?g.length:void 0)||(this.options.keyprefix="clientupload"),null==this.options.autostart&&(this.options.autostart=!0),this._validate(),this.options.autostart&&this.emit("start")}return g(b,a),b.prototype.states=["new","start","signed","upload","progress","done","invalid","error","aborted"],b.prototype.start=function(){return this.state<=0&&(this._setState(1),this.client.emit("file.upload",this),this._sign()),this},b.prototype.abort=function(){var a;return this.state<=4&&(this._setState(8),null!=(a=this.requestUpload)&&a.abort(),this.emit("aborted"),this.client.emit("file.aborted",this)),this},b.prototype.getState=function(){return this.states[this.state]},b.prototype.getResult=function(){return 5===this.state&&null!=this.data?{url:this.data.url,hash:this.data.filehash,key:this.data.key,type:this.data.content_type}:null},b.prototype.getProgress=function(a){var b;return null==a&&(a=!1),b=this.state<4?0:this.state>4?1:this.progressState,a?b:Math.round(100*b)},b.prototype.getName=function(){return this.file.name},b.prototype.getType=function(){return this.file.type},b.prototype.getData=function(){var a;return a={name:this.client.formname,filename:this.getName(),idx:this.idx,state:this.getState(),progress:this.getProgress(),result:this.getResult(),options:this.options,invalid_reason:this.validation,error:this.error}},b.prototype._setState=function(a){return a>this.state&&(this.state=a,this.emit("state",this.getState())),a},b.prototype._validate=function(){var a,b;return a=this.file.size/1024,this.options.maxsize>0&&this.options.maxsize<a&&this.validation.push("maxsize"),(null!=(b=this.options.acceptRules)?b.length:void 0)&&!this._testMime(this.options.acceptRules)&&this.validation.push("accept"),this.validation.length?(this._setState(6),this.emit("invalid",this.validation),this.client.emit("file.invalid",this,this.validation),!1):!0},b.prototype._testMime=function(a){var b,c,d;for(c=0,d=a.length;d>c;c++)if((b=a[c])(this.file))return!0;return!1},b.prototype._now=function(){return Math.round(Date.now()/1e3)},b.prototype._rgxFile2Key=/([^A-Za-z0-9])/gi,b.prototype._sign=function(){var a,b;b=this.getName(),a=this.getType(),this.state>1||(this.url=this.options.host+this.options.domain+"/"+this.key,this.json={blob:!0,acl:this.options.acl,ttl:this.options.ttl,properties:{filename:b}},null!=this.options.width&&(this.json.width=this.options.width),null!=this.options.height&&(this.json.height=this.options.height),null!=this.options.tags&&(this.json.tags=this.options.tags),null!=this.options.properties&&(this.json.properties=this.options.properties),null!=this.options["content-disposition"]&&(this.json["content-disposition"]=this.options["content-disposition"]),(null!=a?a.length:void 0)&&(this.json.content_type=a),this.emit("content",this.key,this.json),this.client.emit("file.content",this,this.key,this.json),this.client.sign.call(this,{url:this.url,key:this.key,json:this.json},function(a){return function(b,c){return a.url=c,b?(a.error=b,a._setState(7),a.emit("error",b),void a.client.emit("file.error",a,b)):(a._setState(2),void a.emit("signed"))}}(this)))},b.prototype._upload=function(){var a,b,c;this.state>2||(this._setState(3),b=new FormData,b.append("JSON",JSON.stringify(this.json)),b.append("blob",this.file),a=new window.XMLHttpRequest,null!=(c=a.upload)&&c.addEventListener("progress",this._handleProgress(),!1),a.addEventListener("progress",this._handleProgress(),!1),a._isfile=!0,this.requestUpload=e({xhr:a,url:this.url,method:"POST",data:b},function(a){return function(b,c,d){var e;return b?(a._setState(7),a.progressState=0,a.error=b,a.emit("error",b),void a.client.emit("file.error",a,b)):(e=JSON.parse(d),c.statusCode>=300?(a._setState(7),a.progressState=0,a.error=e,a.emit("error",e),void a.client.emit("file.error",a,e)):(a.data=null!=e?e.rows[0]:void 0,a.progressState=1,a._setState(5),a.emit("done",a.data),void a.client.emit("file.done",a)))}}(this)))},b.prototype._handleProgress=function(){return function(a){return function(b){return null==b.target.method?(a.progressState=b.loaded/b.total,a._setState(4),void a.emit("progress",a.getProgress(),b)):void 0}}(this)},b}(a("./base")),b.exports=d},{"./base":2,xhr:9}],5:[function(a,b,c){var d,e,f=function(a,b){return function(){return a.apply(b,arguments)}},g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty;e=a("domel"),d=function(a){function b(a,c,d){this.fileObj=a,this.client=c,this.options=d,this.update=f(this.update,this),this.render=f(this.render,this),b.__super__.constructor.apply(this,arguments),null!=this.options.resultTemplateFn&&"function"==typeof this.options.resultTemplateFn?this.template=this.options.resultTemplateFn:this.template=this._defaultTemplate,null!=this.options.cssfileelement?this.resultClass=this.options.cssfileelement:this.resultClass="file col-sm-6 col-md-4",this.fileObj.on("progress",this.update()),this.fileObj.on("done",this.update()),this.fileObj.on("error",this.update()),this.fileObj.on("invalid",this.update())}return g(b,a),b.prototype.render=function(){return this.el=e.create("div",{"class":this.resultClass}),this.el.innerHTML=this.template(this.fileObj.getData()),this.el},b.prototype.update=function(){return function(a){return function(b){a.el.innerHTML=a.template(a.fileObj.getData())}}(this)},b.prototype._defaultTemplate=function(a){var b,c,d,e,f,g,h,i;switch(b='<div class="thumbnail state-'+a.state+'">\n	<b>'+a.filename+"</b>",a.state){case"progress":b+='<div class="progress">\n	<div class="progress-bar" role="progressbar" aria-valuenow="'+a.progress+'" aria-valuemin="0" aria-valuemax="100" style="width: '+a.progress+'%;">\n		<span>'+a.progress+"%</span>\n	</div>\n</div>";break;case"done":b+='<div class="result">\n	<a href="'+a.result.url+'" target="_new">Fertig! ( '+a.result.key+" )</a>",h=a.result;for(c in h)e=h[c],b+='<input type="hidden" name="'+a.name+"_"+a.idx+"_"+c+'" value="'+e+'">';b+="</div>";break;case"invalid":for(b+='<div class="result">\n	<b>Invalid</b>',i=a.invalid_reason,f=0,g=i.length;g>f;f++){switch(d=i[f]){case"maxsize":b+='<div class="alert alert-error">File too big. Only files until '+a.options.maxsize+"kb are allowed.</div>";break;case"accept":b+='<div class="alert alert-error">Wrong type. Only files of type '+a.options.accept.join(", ")+" are allowed.</div>"}b+="</div>"}break;case"error":b+='<div class="alert alert-error">An Error occured.</div>';break;case"aborted":b+='<div class="alert alert-error">Upload aborted.</div>'}return b+="</div>"},b}(a("./base")),b.exports=d},{"./base":2,domel:1}],6:[function(a,b,c){var d,e,f,g;d=a("./base"),f=a("./file"),g=a("./fileview"),e=a("./client"),e.Base=d,e.File=f,e.FileView=g,b.exports=e},{"./base":2,"./client":3,"./file":4,"./fileview":5}],7:[function(a,b,c){var d,e,f,g,h,i,j=[].slice;h=function(a){return null!==a&&"object"==typeof a},f=function(a){return"[object Array]"===Object.prototype.toString.call(a)},i=function(a){return"string"==typeof a||a instanceof String},d=/^\d+$/,g=function(a){return d.test(a)},e=function(){var a,b,c,d,e,f,g;for(g=arguments[0],f=2<=arguments.length?j.call(arguments,1):[],c=0,d=f.length;d>c;c++)if(e=f[c],h(e))for(a in e)b=e[a],g[a]=b;return g},b.exports={isArray:f,isObject:h,isString:i,isInt:g,assign:e}},{}],8:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return"function"==typeof a}function f(a){return"number"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.')}if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(d=arguments.length,f=new Array(d-1),i=1;d>i;i++)f[i-1]=arguments[i];c.apply(this,f)}else if(g(c)){for(d=arguments.length,f=new Array(d-1),i=1;d>i;i++)f[i-1]=arguments[i];for(j=c.slice(),d=j.length,i=0;d>i;i++)j[i].apply(this,f)}return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned){var c;c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())}return this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(0>d)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?e(a._events[b])?1:a._events[b].length:0}},{}],9:[function(a,b,c){"use strict";function d(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}function e(a,b){function c(){4===l.readyState&&j()}function f(){var a=void 0;if(l.response?a=l.response:"text"!==l.responseType&&l.responseType||(a=l.responseText||l.responseXML),u)try{a=JSON.parse(a)}catch(b){}return a}function g(a){clearTimeout(o),a instanceof Error||(a=new Error(""+(a||"Unknown XMLHttpRequest Error"))),a.statusCode=0,b(a,k)}function j(){if(!n){var c;clearTimeout(o),c=a.useXDR&&void 0===l.status?200:1223===l.status?204:l.status;var d=k,e=null;0!==c?(d={body:f(),statusCode:c,method:q,headers:{},url:p,rawRequest:l},l.getAllResponseHeaders&&(d.headers=i(l.getAllResponseHeaders()))):e=new Error("Internal XMLHttpRequest Error"),b(e,d,d.body)}}var k={body:void 0,headers:{},statusCode:0,method:q,url:p,rawRequest:l};if("string"==typeof a&&(a={uri:a}),a=a||{},"undefined"==typeof b)throw new Error("callback argument missing");b=h(b);var l=a.xhr||null;l||(l=a.cors||a.useXDR?new e.XDomainRequest:new e.XMLHttpRequest);var m,n,o,p=l.url=a.uri||a.url,q=l.method=a.method||"GET",r=a.body||a.data,s=l.headers=a.headers||{},t=!!a.sync,u=!1;if("json"in a&&(u=!0,s.accept||s.Accept||(s.Accept="application/json"),"GET"!==q&&"HEAD"!==q&&(s["content-type"]||s["Content-Type"]||(s["Content-Type"]="application/json"),r=JSON.stringify(a.json))),l.onreadystatechange=c,l.onload=j,l.onerror=g,l.onprogress=function(){},l.ontimeout=g,l.open(q,p,!t,a.username,a.password),t||(l.withCredentials=!!a.withCredentials),!t&&a.timeout>0&&(o=setTimeout(function(){n=!0,l.abort("timeout");var a=new Error("XMLHttpRequest timeout");a.code="ETIMEDOUT",g(a)},a.timeout)),l.setRequestHeader)for(m in s)s.hasOwnProperty(m)&&l.setRequestHeader(m,s[m]);else if(a.headers&&!d(a.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in a&&(l.responseType=a.responseType),"beforeSend"in a&&"function"==typeof a.beforeSend&&a.beforeSend(l),l.send(r),l}function f(){}var g=a("global/window"),h=a("once"),i=a("parse-headers");b.exports=e,e.XMLHttpRequest=g.XMLHttpRequest||f,e.XDomainRequest="withCredentials"in new e.XMLHttpRequest?e.XMLHttpRequest:g.XDomainRequest},{"global/window":10,once:11,
"parse-headers":15}],10:[function(a,b,c){(function(a){"undefined"!=typeof window?b.exports=window:"undefined"!=typeof a?b.exports=a:"undefined"!=typeof self?b.exports=self:b.exports={}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],11:[function(a,b,c){function d(a){var b=!1;return function(){return b?void 0:(b=!0,a.apply(this,arguments))}}b.exports=d,d.proto=d(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return d(this)},configurable:!0})})},{}],12:[function(a,b,c){function d(a,b,c){if(!h(b))throw new TypeError("iterator must be a function");arguments.length<3&&(c=this),"[object Array]"===i.call(a)?e(a,b,c):"string"==typeof a?f(a,b,c):g(a,b,c)}function e(a,b,c){for(var d=0,e=a.length;e>d;d++)j.call(a,d)&&b.call(c,a[d],d,a)}function f(a,b,c){for(var d=0,e=a.length;e>d;d++)b.call(c,a.charAt(d),d,a)}function g(a,b,c){for(var d in a)j.call(a,d)&&b.call(c,a[d],d,a)}var h=a("is-function");b.exports=d;var i=Object.prototype.toString,j=Object.prototype.hasOwnProperty},{"is-function":13}],13:[function(a,b,c){function d(a){var b=e.call(a);return"[object Function]"===b||"function"==typeof a&&"[object RegExp]"!==b||"undefined"!=typeof window&&(a===window.setTimeout||a===window.alert||a===window.confirm||a===window.prompt)}b.exports=d;var e=Object.prototype.toString},{}],14:[function(a,b,c){function d(a){return a.replace(/^\s*|\s*$/g,"")}c=b.exports=d,c.left=function(a){return a.replace(/^\s*/,"")},c.right=function(a){return a.replace(/\s*$/,"")}},{}],15:[function(a,b,c){var d=a("trim"),e=a("for-each"),f=function(a){return"[object Array]"===Object.prototype.toString.call(a)};b.exports=function(a){if(!a)return{};var b={};return e(d(a).split("\n"),function(a){var c=a.indexOf(":"),e=d(a.slice(0,c)).toLowerCase(),g=d(a.slice(c+1));"undefined"==typeof b[e]?b[e]=g:f(b[e])?b[e].push(g):b[e]=[b[e],g]}),b}},{"for-each":12,trim:14}]},{},[6])(6)});